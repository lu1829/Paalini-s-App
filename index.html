<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Brain Journal Organizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      font-family: "Nunito Sans", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #05060a;
      color: #f5f5f5;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 4px;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 1.1rem;
    }

    .subtitle {
      margin-bottom: 16px;
      font-size: 0.9rem;
      color: #a0a3b7;
    }

    .panel {
      background: #0b0e18;
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 12px;
      border: 1px solid #171a26;
    }

    .panel.small {
      margin-bottom: 10px;
    }

    .label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #8589a3;
      margin-bottom: 6px;
    }

    .journal-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    select {
      background: #05060a;
      color: #f5f5f5;
      border-radius: 999px;
      border: 1px solid #262a3d;
      padding: 6px 10px;
      font-size: 0.8rem;
      min-width: 180px;
    }

    textarea {
      width: 100%;
      resize: vertical;
      background: #05060a;
      color: #f5f5f5;
      border-radius: 10px;
      border: 1px solid #262a3d;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    textarea:focus, select:focus {
      outline: 1px solid #5f7bff;
      box-shadow: 0 0 0 1px #5f7bff33;
    }

    #entryNote {
      min-height: 60px;
      font-size: 0.8rem;
    }

    #dumpInput {
      min-height: 120px;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-family: inherit;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
      white-space: nowrap;
    }

    button.primary {
      background: linear-gradient(135deg, #5f7bff, #f26dd4);
      color: #05060a;
      font-weight: 600;
      box-shadow: 0 3px 10px rgba(0,0,0,0.35);
    }

    button.secondary {
      background: #151827;
      color: #d0d3ea;
      border: 1px solid #262a3d;
    }

    button.danger {
      background: #301017;
      color: #ffb4c4;
      border: 1px solid #5a1d2c;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.45);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .board-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #8589a3;
    }

    .board {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      overflow-x: auto;
      padding-bottom: 10px;
    }

    .column {
      background: #090b13;
      border-radius: 14px;
      border: 1px solid #171a26;
      min-width: 220px;
      max-width: 260px;
      flex: 1;
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - 260px);
    }

    .column-header {
      padding: 8px 10px 6px;
      border-bottom: 1px solid #171a26;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .column-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #8b8fb0;
      margin-bottom: 2px;
    }

    .column-title[contenteditable="true"] {
      cursor: text;
    }

    .column-hint {
      font-size: 0.7rem;
      color: #5f6378;
    }

    .column-body {
      padding: 8px;
      overflow-y: auto;
      flex: 1;
    }

    .column-body.drag-hover {
      outline: 1px dashed #5f7bff;
      outline-offset: -4px;
      background: #090b13ea;
    }

    .card {
      border-radius: 10px;
      padding: 7px 8px;
      margin-bottom: 7px;
      font-size: 0.78rem;
      line-height: 1.35;
      background: linear-gradient(135deg, #21253a, #181b2b);
      border: 1px solid rgba(255,255,255,0.05);
      cursor: grab;
      user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.45);
    }

    .card.dragging {
      opacity: 0.6;
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
    }

    .card-text {
      outline: none;
    }

    .card-text[contenteditable="true"]:focus {
      border-radius: 6px;
      box-shadow: 0 0 0 1px #5f7bff;
      padding: 1px 2px;
      margin: -1px -2px;
      background: rgba(5,6,10,0.6);
    }

    .empty-hint {
      font-size: 0.7rem;
      color: #4f5264;
      font-style: italic;
      padding: 4px 2px;
    }

    @media (max-width: 768px) {
      body { padding: 12px; }
      .column { min-width: 200px; }
    }

    /* Keep colors on print ‚Äì no overriding background */
    @media print {
      button, select, #dumpInput {
        display: none;
      }
      .panel, .column {
        box-shadow: none;
      }
      body {
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>BRAIN JOURNAL ORGANIZER</h1>
    <div class="subtitle">
      Each entry is a snapshot of your brain: dump, organize, drag things into problems / ideas / solutions.
      Everything is saved locally as a journal.
    </div>

    <!-- JOURNAL PANEL -->
    <div class="panel small">
      <div class="label">Journal entry</div>
      <div class="journal-row">
        <select id="entrySelect"></select>
        <button class="secondary" id="newEntryBtn">‚ûï New entry</button>
        <button class="secondary" id="renameEntryBtn">‚úèÔ∏è Rename</button>
        <button class="danger" id="deleteEntryBtn">üóë Delete entry</button>
      </div>
      <textarea id="entryNote" placeholder="Notes for this entry (context, mood, what you're trying to solve)..."></textarea>
    </div>

    <!-- DUMP PANEL -->
    <div class="panel">
      <div class="label">Brain dump</div>
      <textarea id="dumpInput" placeholder="Write or paste anything here.&#10;One thought per line works best."></textarea>
      <div class="controls">
        <button class="primary" id="explodeBtn">‚úÇÔ∏è Explode & organize</button>
        <button class="secondary" id="autoSortBtn">üß† Re-run organize on Inbox</button>
        <button class="secondary" id="printBtn">üñ® Export / Print</button>
        <button class="danger" id="clearBoardBtn">üßπ Clear board (this entry)</button>
      </div>
    </div>

    <div class="board-header">
      <div class="board-label">Board</div>
      <div class="controls">
        <button class="secondary" id="addColumnBtn">‚ûï Add column</button>
      </div>
    </div>

    <div class="board" id="board"></div>
  </div>

  <script>
    const JOURNAL_KEY = "brainJournal_v1";

    const defaultColumns = [
      { id: "inbox", title: "Inbox", hint: "Fresh pieces land here.", cards: [] },
      { id: "problems", title: "Problems", hint: "What is hurting, blocking, confusing.", cards: [] },
      { id: "ideas", title: "Ideas", hint: "Possibilities, maybes, crazy thoughts.", cards: [] },
      { id: "solutions", title: "Solutions", hint: "Concrete steps, experiments, moves.", cards: [] }
    ];

    const dumpInput = document.getElementById("dumpInput");
    const explodeBtn = document.getElementById("explodeBtn");
    const autoSortBtn = document.getElementById("autoSortBtn");
    const printBtn = document.getElementById("printBtn");
    const clearBoardBtn = document.getElementById("clearBoardBtn");
    const addColumnBtn = document.getElementById("addColumnBtn");
    const board = document.getElementById("board");

    const entrySelect = document.getElementById("entrySelect");
    const newEntryBtn = document.getElementById("newEntryBtn");
    const renameEntryBtn = document.getElementById("renameEntryBtn");
    const deleteEntryBtn = document.getElementById("deleteEntryBtn");
    const entryNote = document.getElementById("entryNote");

    let draggedCard = null;
    let journal = {
      entries: [],
      activeEntryId: null
    };

    /* ---------- JOURNAL STATE ---------- */

    function loadJournal() {
      const raw = localStorage.getItem(JOURNAL_KEY);
      if (raw) {
        try {
          const parsed = JSON.parse(raw);
          if (parsed && Array.isArray(parsed.entries)) {
            journal = parsed;
          }
        } catch (e) {}
      }

      if (!journal.entries.length) {
        createNewEntry(true);
      } else if (!journal.activeEntryId) {
        journal.activeEntryId = journal.entries[0].id;
      }

      renderEntrySelect();
      loadActiveEntryToUI();
    }

    function saveJournal() {
      const active = getActiveEntry();
      if (active) {
        active.state = captureBoardState();
        active.note = entryNote.value;
      }
      localStorage.setItem(JOURNAL_KEY, JSON.stringify(journal));
    }

    function getActiveEntry() {
      return journal.entries.find(e => e.id === journal.activeEntryId) || null;
    }

    function createNewEntry(isFirst = false) {
      const now = new Date();
      const label = now.toISOString().slice(0,10); // yyyy-mm-dd
      const id = "entry_" + now.getTime();

      const entry = {
        id,
        title: isFirst ? label + " (first)" : label,
        createdAt: now.toISOString(),
        note: "",
        state: { columns: JSON.parse(JSON.stringify(defaultColumns)) }
      };

      journal.entries.push(entry);
      journal.activeEntryId = id;
      renderEntrySelect();
      loadActiveEntryToUI();
      saveJournal();
    }

    function deleteCurrentEntry() {
      if (!journal.activeEntryId) return;
      if (journal.entries.length === 1) {
        if (!confirm("Delete the only entry? This will reset everything.")) return;
        journal.entries = [];
        journal.activeEntryId = null;
        createNewEntry(true);
        saveJournal();
        return;
      }
      const active = getActiveEntry();
      if (!active) return;
      if (!confirm(`Delete entry "${active.title}"?`)) return;

      journal.entries = journal.entries.filter(e => e.id !== journal.activeEntryId);
      journal.activeEntryId = journal.entries[0].id;
      renderEntrySelect();
      loadActiveEntryToUI();
      saveJournal();
    }

    function renderEntrySelect() {
      entrySelect.innerHTML = "";
      journal.entries.forEach(entry => {
        const opt = document.createElement("option");
        opt.value = entry.id;
        opt.textContent = entry.title;
        if (entry.id === journal.activeEntryId) opt.selected = true;
        entrySelect.appendChild(opt);
      });
    }

    function loadActiveEntryToUI() {
      const active = getActiveEntry();
      if (!active) return;

      entryNote.value = active.note || "";
      board.innerHTML = "";
      const state = active.state && Array.isArray(active.state.columns)
        ? active.state
        : { columns: JSON.parse(JSON.stringify(defaultColumns)) };

      state.columns.forEach(colState => createColumn(colState));
      addEmptyHints();
    }

    /* ---------- BOARD STATE ---------- */

    function captureBoardState() {
      const columns = [];
      document.querySelectorAll(".column").forEach(col => {
        const id = col.dataset.id;
        const title = col.querySelector(".column-title").textContent.trim() || "Untitled";
        const hint = col.querySelector(".column-hint")?.textContent || "";
        const cards = Array.from(col.querySelectorAll(".card-text")).map(ct => ct.textContent);
        columns.push({ id, title, hint, cards });
      });
      return { columns };
    }

    /* ---------- UI HELPERS ---------- */

    function removeEmptyHints() {
      document.querySelectorAll(".empty-hint").forEach(h => h.remove());
    }

    function addEmptyHints() {
      document.querySelectorAll(".column-body").forEach(body => {
        if (!body.querySelector(".card") && !body.querySelector(".empty-hint")) {
          const hint = document.createElement("div");
          hint.className = "empty-hint";
          hint.textContent = "Drop cards here.";
          body.appendChild(hint);
        }
      });
    }

    function createColumn(columnState) {
      const col = document.createElement("div");
      col.className = "column";
      col.dataset.id = columnState.id;

      const header = document.createElement("div");
      header.className = "column-header";

      const title = document.createElement("div");
      title.className = "column-title";
      title.contentEditable = "true";
      title.textContent = columnState.title || "Untitled";
      title.addEventListener("blur", saveJournal);

      const hint = document.createElement("div");
      hint.className = "column-hint";
      hint.textContent = columnState.hint || "";

      const body = document.createElement("div");
      body.className = "column-body";
      addDropHandlers(body);

      header.appendChild(title);
      header.appendChild(hint);
      col.appendChild(header);
      col.appendChild(body);
      board.appendChild(col);

      (columnState.cards || []).forEach(text => {
        createCard(text, body);
      });
    }

    function createCard(text, targetBody) {
      const card = document.createElement("div");
      card.className = "card";
      card.draggable = true;

      const inner = document.createElement("div");
      inner.className = "card-text";
      inner.contentEditable = "true";
      inner.textContent = text;

      inner.addEventListener("blur", saveJournal);

      card.appendChild(inner);
      addDragHandlers(card);

      removeEmptyHints();
      targetBody.appendChild(card);
    }

    function addDragHandlers(card) {
      card.addEventListener("dragstart", (e) => {
        draggedCard = card;
        card.classList.add("dragging");
        e.dataTransfer.effectAllowed = "move";
      });

      card.addEventListener("dragend", () => {
        if (draggedCard === card) {
          draggedCard = null;
        }
        card.classList.remove("dragging");
        saveJournal();
      });
    }

    function addDropHandlers(body) {
      body.addEventListener("dragover", (e) => {
        if (!draggedCard) return;
        e.preventDefault();
        body.classList.add("drag-hover");
      });

      body.addEventListener("dragleave", () => {
        body.classList.remove("drag-hover");
      });

      body.addEventListener("drop", (e) => {
        e.preventDefault();
        body.classList.remove("drag-hover");
        if (!draggedCard) return;
        removeEmptyHints();
        body.appendChild(draggedCard);
        saveJournal();
      });
    }

    /* ---------- LOGIC: CLASSIFICATION ---------- */

    function classifyLine(text) {
      const t = text.toLowerCase();

      const isProblem = /(problem|issue|stuck|block|worry|anxiety|scared|fear|confused|overwhelmed)/.test(t);
      const isIdea = /(idea|maybe|could|what if|imagine|dream|potential)/.test(t);
      const isSolution = /(next step|i will|i'll|plan|do this|action|solution|experiment)/.test(t);

      if (isSolution) return "solutions";
      if (isIdea) return "ideas";
      if (isProblem) return "problems";
      return "inbox";
    }

    function explodeAndOrganize() {
      const text = dumpInput.value;
      if (!text.trim()) return;

      const lines = text
        .split("\n")
        .map(l => l.trim())
        .filter(l => l.length > 0);

      if (!lines.length) return;

      const bodies = {
        inbox: document.querySelector('.column[data-id="inbox"] .column-body'),
        problems: document.querySelector('.column[data-id="problems"] .column-body'),
        ideas: document.querySelector('.column[data-id="ideas"] .column-body'),
        solutions: document.querySelector('.column[data-id="solutions"] .column-body')
      };

      const fallbackBody = bodies.inbox || document.querySelector(".column-body");

      lines.forEach(line => {
        const colId = classifyLine(line);
        const target = bodies[colId] || fallbackBody;
        createCard(line, target);
      });

      dumpInput.value = "";
      saveJournal();
      addEmptyHints();
    }

    function autoSortInbox() {
      const inboxBody = document.querySelector('.column[data-id="inbox"] .column-body');
      if (!inboxBody) return;

      const problemsBody = document.querySelector('.column[data-id="problems"] .column-body');
      const ideasBody = document.querySelector('.column[data-id="ideas"] .column-body');
      const solutionsBody = document.querySelector('.column[data-id="solutions"] .column-body');

      const bodies = { problems: problemsBody, ideas: ideasBody, solutions: solutionsBody };

      const cards = Array.from(inboxBody.querySelectorAll(".card"));
      if (!cards.length) return;

      removeEmptyHints();

      cards.forEach(card => {
        const text = card.innerText.trim();
        const targetCol = classifyLine(text);
        if (targetCol !== "inbox" && bodies[targetCol]) {
          bodies[targetCol].appendChild(card);
        }
      });

      saveJournal();
      addEmptyHints();
    }

    function clearBoardForEntry() {
      if (!confirm("Clear all cards for this entry?")) return;
      board.innerHTML = "";
      defaultColumns.forEach(col => createColumn(col));
      addEmptyHints();
      saveJournal();
    }

    function addColumn() {
      const id = "col_" + Date.now();
      const columnState = {
        id,
        title: "New column",
        hint: "Rename and use however you want.",
        cards: []
      };
      createColumn(columnState);
      addEmptyHints();
      saveJournal();
    }

    /* ---------- EVENTS ---------- */

    explodeBtn.addEventListener("click", explodeAndOrganize);
    autoSortBtn.addEventListener("click", autoSortInbox);
    clearBoardBtn.addEventListener("click", clearBoardForEntry);
    addColumnBtn.addEventListener("click", addColumn);

    printBtn.addEventListener("click", () => {
      window.print();
    });

    dumpInput.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        explodeAndOrganize();
      }
    });

    entrySelect.addEventListener("change", () => {
      saveJournal();
      journal.activeEntryId = entrySelect.value;
      loadActiveEntryToUI();
    });

    newEntryBtn.addEventListener("click", () => {
      saveJournal();
      createNewEntry(false);
    });

    renameEntryBtn.addEventListener("click", () => {
      const active = getActiveEntry();
      if (!active) return;
      const newTitle = prompt("New entry name:", active.title);
      if (!newTitle) return;
      active.title = newTitle;
      renderEntrySelect();
      saveJournal();
    });

    deleteEntryBtn.addEventListener("click", deleteCurrentEntry);

    entryNote.addEventListener("blur", saveJournal);

    /* ---------- INIT ---------- */
    loadJournal();
  </script>
</body>
</html>

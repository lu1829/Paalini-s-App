<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Codebook Interactive</title>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --text-primary: #2F323A;
      --text-secondary: #848484;
      --bg-panel: #EEF0F4;
      --bg-page: #FFFFFF;

      --theme-1-yellow: #f9eea2;
      --theme-2-green: #BBEED5;
      --theme-3-purple: #B9B3F8;
      --theme-4-blue: #C0DBEE;

      --btn-hover: #e2e4e8;
      --accent-primary: #B9B3F8;
    }

    * { box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-page);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 20px 40px;
      background-color: var(--bg-page);
      border-bottom: 1px solid var(--bg-panel);
      flex-shrink: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    .header-content h1 {
      margin: 0;
      font-size: 24px;
      color: var(--text-primary);
    }

    .header-content p.subtitle {
      margin: 5px 0 0 0;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      background-color: var(--bg-panel);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      cursor: pointer;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover { background-color: var(--btn-hover); }

    .btn-primary {
      background-color: var(--accent-primary);
      color: #fff;
    }
    .btn-primary:hover { opacity: 0.9; }

    input[type="file"] { display: none; }

    .board-container {
      flex: 1;
      overflow-x: auto;
      overflow-y: hidden;
      padding: 30px 40px;
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }

    .column {
      background-color: var(--bg-panel);
      min-width: 360px;
      max-width: 360px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      max-height: 100%;
      flex-shrink: 0;
      transition: box-shadow 0.2s;
    }

    .column-header {
      padding: 16px 20px;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      color: var(--text-primary);
      position: sticky;
      top: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      z-index: 10;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .col-title {
      font-weight: 800;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.5px;
    }

    .card-count {
      background: rgba(255,255,255,0.6);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .card-list {
      padding: 12px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 50px;
    }

    .subsection-title {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      margin-top: 12px;
      margin-bottom: 4px;
      padding-left: 4px;
      letter-spacing: 0.5px;
      pointer-events: none;
    }

    .card {
      background-color: #FFFFFF;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.03);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid transparent;
      cursor: grab;
      position: relative;
    }

    .card:active { cursor: grabbing; }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
    }

    .card-text {
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-primary);
      font-weight: 600;
    }

    .card-type {
      display: inline-block;
      margin-top: 10px;
      font-size: 10px;
      text-transform: uppercase;
      color: var(--text-secondary);
      background-color: var(--bg-panel);
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 600;
    }

    .card-quote {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #f0f0f0;
      font-size: 12px;
      line-height: 1.5;
      color: #666;
      font-style: italic;
      display: none;
      white-space: pre-wrap;
    }

    .card-quote.visible { display: block; }

    .col-theme-1 { background-color: var(--theme-1-yellow); }
    .col-theme-2 { background-color: var(--theme-2-green); }
    .col-theme-3 { background-color: var(--theme-3-purple); }
    .col-theme-4 { background-color: var(--theme-4-blue); }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #9CA3AF; }
  </style>

  <!-- Google Translate -->
  <script>
    function translatePage() {
      new google.translate.TranslateElement(
        {
          pageLanguage: 'en',
          includedLanguages: 'en,it',
          autoDisplay: false
        },
        'google_translate_element'
      );
    }
  </script>
  <script src="https://translate.google.com/translate_a/element.js?cb=translatePage"></script>
</head>

<body>
  <header>
    <div class="header-content">
      <h1>Codebook</h1>
      <p class="subtitle">Consolidated View: 4 Core Themes</p>
    </div>

    <div class="controls" data-html2canvas-ignore="true">
      <input type="file" id="csvInput" accept=".csv" />
      <button class="btn btn-primary" id="importBtn">üìÇ Import CSV to Add Quotes</button>
      <button class="btn" id="addCodeBtn">+ Add Card</button>
      <button class="btn" id="saveBtn">Save Layout</button>
      <button class="btn" id="exportPdfBtn">Export PDF</button>
      <div id="google_translate_element"></div>
    </div>
  </header>

  <!-- OPTIONAL: Embed CSV directly into the HTML (no upload needed).
       Put your CSV content inside this tag.
       It will be used ONLY the first time (when no saved layout exists). -->
  <script id="embeddedCsv" type="text/plain">
tag,content
  </script>

  <div class="board-container" id="board">

    <!-- Theme 1 -->
    <div class="column">
      <div class="column-header col-theme-1">
        <div class="header-top">
          <span class="col-title">Theme 1: Human Authorship</span>
          <span class="card-count">0</span>
        </div>
      </div>
      <div class="card-list">
        <div class="subsection-title">Identity & Expression</div>
        <div class="card"><div class="card-text">Openness / freedom of circulation</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Disapproval of reliance on AI for creative ideation</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Sees content-creator role as marginal to core artistic identity</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI disrupts the ability to evaluate artistic authorship</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">human made content is nourishing</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Artistic identity grounded in intrinsic personal expression</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Ethical awareness as creative identity</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Values clarity to prevent authorship and rights disputes</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Uses social media as professional showcase</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">identity anchored in purpose/professionalism</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">his work expresses ideas, not his inner emotional state.</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Uses social media for professional visibility, not persona building</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Professional authorship is kept separate from AI influence</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Human talent is assumed real within trusted communities</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">believes time and effort produce authenticity</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Human authorship anchored in personal narrative rather than technical craft</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Human Intent vs. AI Autonomy (‚ÄúHuman objective determines perceived legitimacy‚Äù)</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Reluctance to Disclose Minor AI Use</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Creator Identity Threatened by Over-labeling</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Reliance on social cues to identify AI</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Multiplatform creator identity</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Artistic primary authorship (‚ÄúI am an independent artist-composer‚Äù)</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">utilitarian visual identity (singer)</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Platform dependency for visibility (‚ÄúAlgorithmic pressure to produce visuals‚Äù)</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Visual content as secondary to the true creative product (‚ÄúVisuals support music‚Äù)</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI visual generation 'skills' as a threat</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Aesthetic Resistance to large labels/ ‚ÄúLarge labels interfere with presentation‚Äù</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">‚ÄúLabel erases human creativity‚Äù / Fear of Misattributed Authorship</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI increases speed, efficiency, cost, and reduces creative bottlenecks</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">‚ÄúCreativity still comes from me‚Äù / Assertion of human primacy</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Fear of losing critical judgement / ai as a threat to professional visual discernment</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Perfection as a cue of synthetic origin</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Artist identity rooted in idea generation</div><div class="card-type">code</div><div class="card-quote"></div></div>

        <div class="subsection-title">Trust & Ethics</div>
        <div class="card"><div class="card-text">Ethical expectation of transparency in creative authorship</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Labels are a moral practice</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Fear that AI-created final outputs undermine the craft.</div><div class="card-type">code</div><div class="card-quote"></div></div>

        <div class="subsection-title">Fears & Hopes</div>
        <div class="card"><div class="card-text">Frustration towards the loss of creaive agency in ideation</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">fear of losing the capacity to imagine without AI</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Hope that human made art will be more valued for its effort and quality</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">wants clarity and specificity in creative disclosure</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Values representation of creative labor</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Audiences will eventually sharpen their eye to distinguish human vs AI.</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Creative Anxiety / ‚ÄúIf AI can do this, what happens to human creativity?‚Äù</div><div class="card-type">code</div><div class="card-quote"></div></div>
      </div>
    </div>

    <!-- Theme 2 -->
    <div class="column">
      <div class="column-header col-theme-2">
        <div class="header-top">
          <span class="col-title">Theme 2: Labels as Signals</span>
          <span class="card-count">0</span>
        </div>
      </div>
      <div class="card-list">
        <div class="subsection-title">Label Perception</div>
        <div class="card"><div class="card-text">Perception ai images/ labels conflict from unrealistic AI-generated standards</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Labels seen as a plausible practice of maintaining creator‚Äìaudience trust</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Perceives AI-generated imagery as economically displacing illustrators</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Need for labels to show her true value over AI content</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI-Assisted label means a human gave idea to the machine</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">‚ÄúMade with AI‚Äù label as meaning that the image has no human-originated creative input</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Co-created with AI label highlights ambiguity</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Perceives disclosure as credibility signals</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Sees labels as fillters in an information stream</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI-generated image: Hyper-realism creates uncertainty</div><div class="card-type">code</div><div class="card-quote"></div></div>

        <div class="subsection-title">Label Functions</div>
        <div class="card"><div class="card-text">Labels as a practice of maintaining creator‚Äìaudience trust</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Sees labels as a solution to restore user agency sees labels as segmentation cues that sort audiences by content preference</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Ethical Imperative for High-Impact Content / ‚ÄúFor news and socially impactful media, labels are mandatory‚Äù</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">‚ÄúLabels need nuance‚Äù / Desire for percentage disclosure</div><div class="card-type">code</div><div class="card-quote"></div></div>
      </div>
    </div>

    <!-- Theme 3 -->
    <div class="column">
      <div class="column-header col-theme-3">
        <div class="header-top">
          <span class="col-title">Theme 3: AI as Tool</span>
          <span class="card-count">0</span>
        </div>
      </div>
      <div class="card-list">
        <div class="card"><div class="card-text">Curiosity towards AI as a creative tool</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Negotiating adoption while protecting creative agency</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI accepted as a reference tool, but not a creative author</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">AI lacks intentionality and interpretation</div><div class="card-type">code</div><div class="card-quote"></div></div>
      </div>
    </div>

    <!-- Theme 4 -->
    <div class="column">
      <div class="column-header col-theme-4">
        <div class="header-top">
          <span class="col-title">Theme 4: Platform Dynamics</span>
          <span class="card-count">0</span>
        </div>
      </div>
      <div class="card-list">
        <div class="card"><div class="card-text">losing collective ability to tell real from fake</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Sees social media as a space where authenticity is already unstable</div><div class="card-type">code</div><div class="card-quote"></div></div>
        <div class="card"><div class="card-text">Fear of political and harmful misuse</div><div class="card-type">code</div><div class="card-quote"></div></div>
      </div>
    </div>

  </div>

  <script>
    const STORAGE_KEY = 'codebookLayout_v1';

    function normalize(s) {
      return (s || '').trim().toLowerCase();
    }

    function saveBoard() {
      const boardHTML = document.getElementById('board').innerHTML;
      localStorage.setItem(STORAGE_KEY, boardHTML);
    }

    function updateCounts() {
      document.querySelectorAll('.column').forEach(col => {
        const count = col.querySelectorAll('.card').length;
        const counter = col.querySelector('.card-count');
        if (counter) counter.innerText = count;
      });
    }

    function initSortable() {
      document.querySelectorAll('.card-list').forEach(column => {
        new Sortable(column, {
          group: 'shared',
          animation: 150,
          ghostClass: 'sortable-ghost',
          onEnd: () => { updateCounts(); saveBoard(); } // autosave after drag
        });
      });
    }

    // --- CSV hydration (quotes) ---
    function hydrateCards(dataRows) {
      const cards = document.querySelectorAll('.card');
      let matchCount = 0;

      // Build lookup map: tag -> content
      const map = new Map();
      dataRows.forEach(r => {
        const tag = normalize(r.tag);
        const content = (r.content || '').trim();
        if (tag && content) map.set(tag, content);
      });

      cards.forEach(card => {
        const titleEl = card.querySelector('.card-text');
        const quoteEl = card.querySelector('.card-quote');
        if (!titleEl || !quoteEl) return;

        const key = normalize(titleEl.innerText);
        const content = map.get(key);

        if (content) {
          quoteEl.innerText = `"${content}"`;
          quoteEl.classList.add('visible');
          matchCount++;
        }
      });

      updateCounts();
      saveBoard(); // makes quotes persist on reload
      alert(`CSV imported: matched ${matchCount} quotes to existing cards.`);
    }

    // --- Wire up controls ---
    const csvInput = document.getElementById('csvInput');
    document.getElementById('importBtn').addEventListener('click', () => csvInput.click());

    csvInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (!file) return;

      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: (results) => {
          hydrateCards(results.data || []);
          csvInput.value = ''; // allow re-upload same file
        }
      });
    });

    document.getElementById('addCodeBtn').addEventListener('click', () => {
      const title = prompt("Enter the code name:");
      if (!title) return;

      const newCard = document.createElement('div');
      newCard.className = 'card';
      newCard.innerHTML = `
        <div class="card-text">${title}</div>
        <div class="card-type">code</div>
        <div class="card-quote"></div>
      `;

      const firstList = document.querySelector('.card-list');
      if (firstList) firstList.prepend(newCard);

      updateCounts();
      saveBoard(); // persist new card
    });

    document.getElementById('saveBtn').addEventListener('click', () => {
      saveBoard();
      const btn = document.getElementById('saveBtn');
      const original = btn.innerText;
      btn.innerText = "Saved!";
      setTimeout(() => btn.innerText = original, 1000);
    });

    document.getElementById('exportPdfBtn').addEventListener('click', () => {
      const element = document.body;
      const opt = {
        margin: 0,
        filename: 'codebook_export.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' }
      };
      html2pdf().set(opt).from(element).save();
    });

    // --- Boot: restore saved layout OR (first time) hydrate from embedded CSV ---
    window.addEventListener('load', () => {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        document.getElementById('board').innerHTML = saved;
      } else {
        // First run only: if you pasted CSV into #embeddedCsv, apply it automatically
        const raw = document.getElementById('embeddedCsv')?.textContent?.trim();
        if (raw && raw.includes(',')) {
          const parsed = Papa.parse(raw, { header: true, skipEmptyLines: true });
          hydrateCards(parsed.data || []);
          // hydrateCards already saves, so it becomes persistent
        }
      }

      initSortable();
      updateCounts();
    });
  </script>
</body>
</html>
